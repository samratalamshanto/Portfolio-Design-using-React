{"ast":null,"code":"'use strict';\n\nvar fs = require('graceful-fs');\n\nvar assign = require('object-assign');\n\nvar isEqual = require('lodash.isequal');\n\nvar isValidDate = require('vali-date'); // TODO shared module\n// TODO include sticky/setuid/setgid, i.e. 7777?\n\n\nvar MASK_MODE = parseInt('0777', 8);\nvar DEFAULT_FILE_MODE = parseInt('0666', 8);\nvar APPEND_MODE_REGEXP = /a/;\n\nfunction closeFd(propagatedErr, fd, callback) {\n  if (typeof fd !== 'number') {\n    return callback(propagatedErr);\n  }\n\n  fs.close(fd, onClosed);\n\n  function onClosed(closeErr) {\n    if (propagatedErr || closeErr) {\n      return callback(propagatedErr || closeErr);\n    }\n\n    callback();\n  }\n}\n\nfunction getModeDiff(fsMode, vinylMode) {\n  var modeDiff = 0;\n\n  if (typeof vinylMode === 'number') {\n    modeDiff = (vinylMode ^ fsMode) & MASK_MODE;\n  }\n\n  return modeDiff;\n}\n\nfunction getTimesDiff(fsStat, vinylStat) {\n  if (!isValidDate(vinylStat.mtime)) {\n    return;\n  }\n\n  if (isEqual(vinylStat.mtime, fsStat.mtime) && isEqual(vinylStat.atime, fsStat.atime)) {\n    return;\n  }\n\n  var atime;\n\n  if (isValidDate(vinylStat.atime)) {\n    atime = vinylStat.atime;\n  } else {\n    atime = fsStat.atime;\n  }\n\n  if (!isValidDate(atime)) {\n    atime = undefined;\n  }\n\n  var timesDiff = {\n    mtime: vinylStat.mtime,\n    atime: atime\n  };\n  return timesDiff;\n}\n\nfunction isOwner(fsStat) {\n  var hasGetuid = typeof process.getuid === 'function';\n  var hasGeteuid = typeof process.geteuid === 'function'; // If we don't have either, assume we don't have permissions.\n  // This should only happen on Windows.\n  // Windows basically noops fchmod and errors on futimes called on directories.\n\n  if (!hasGeteuid && !hasGetuid) {\n    return false;\n  }\n\n  var uid;\n\n  if (hasGeteuid) {\n    uid = process.geteuid();\n  } else {\n    uid = process.getuid();\n  }\n\n  if (fsStat.uid !== uid && uid !== 0) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction updateMetadata(fd, file, callback) {\n  fs.fstat(fd, onStat);\n\n  function onStat(err, stat) {\n    if (err) {\n      return callback(err, fd);\n    } // Check if mode needs to be updated\n\n\n    var modeDiff = getModeDiff(stat.mode, file.stat.mode); // Check if atime/mtime need to be updated\n\n    var timesDiff = getTimesDiff(stat, file.stat); // Set file.stat to the reflect current state on disk\n\n    assign(file.stat, stat); // Nothing to do\n\n    if (!modeDiff && !timesDiff) {\n      return callback(null, fd);\n    } // Check access, `futimes` and `fchmod` only work if we own the file,\n    // or if we are effectively root.\n\n\n    if (!isOwner(stat)) {\n      return callback(null, fd);\n    }\n\n    if (modeDiff) {\n      return mode();\n    }\n\n    times();\n\n    function mode() {\n      var mode = stat.mode ^ modeDiff;\n      fs.fchmod(fd, mode, onFchmod);\n\n      function onFchmod(fchmodErr) {\n        if (!fchmodErr) {\n          file.stat.mode = mode;\n        }\n\n        if (timesDiff) {\n          return times(fchmodErr);\n        }\n\n        callback(fchmodErr, fd);\n      }\n    }\n\n    function times(fchmodErr) {\n      fs.futimes(fd, timesDiff.atime, timesDiff.mtime, onFutimes);\n\n      function onFutimes(futimesErr) {\n        if (!futimesErr) {\n          file.stat.atime = timesDiff.atime;\n          file.stat.mtime = timesDiff.mtime;\n        }\n\n        callback(fchmodErr || futimesErr, fd);\n      }\n    }\n  }\n}\n/*\n  Custom writeFile implementation because we need access to the\n  file descriptor after the write is complete.\n  Most of the implementation taken from node core.\n */\n\n\nfunction writeFile(path, data, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (!Buffer.isBuffer(data)) {\n    callback(new TypeError('Data must be a Buffer'));\n    return;\n  }\n\n  if (!options) {\n    options = {};\n  } // Default the same as node\n\n\n  var mode = options.mode || DEFAULT_FILE_MODE;\n  var flag = options.flag || 'w';\n  var position = APPEND_MODE_REGEXP.test(flag) ? null : 0;\n  fs.open(path, flag, mode, onOpen);\n\n  function onOpen(err, fd) {\n    if (err) {\n      return onComplete(err);\n    }\n\n    fs.write(fd, data, 0, data.length, position, onComplete);\n\n    function onComplete(err) {\n      callback(err, fd);\n    }\n  }\n}\n\nmodule.exports = {\n  closeFd: closeFd,\n  getModeDiff: getModeDiff,\n  getTimesDiff: getTimesDiff,\n  isOwner: isOwner,\n  updateMetadata: updateMetadata,\n  writeFile: writeFile\n};","map":{"version":3,"names":["fs","require","assign","isEqual","isValidDate","MASK_MODE","parseInt","DEFAULT_FILE_MODE","APPEND_MODE_REGEXP","closeFd","propagatedErr","fd","callback","close","onClosed","closeErr","getModeDiff","fsMode","vinylMode","modeDiff","getTimesDiff","fsStat","vinylStat","mtime","atime","undefined","timesDiff","isOwner","hasGetuid","process","getuid","hasGeteuid","geteuid","uid","updateMetadata","file","fstat","onStat","err","stat","mode","times","fchmod","onFchmod","fchmodErr","futimes","onFutimes","futimesErr","writeFile","path","data","options","Buffer","isBuffer","TypeError","flag","position","test","open","onOpen","onComplete","write","length","module","exports"],"sources":["G:/anaconda/project/download files/last down/New folder/desktop/Samrat/protfolio/protfolio/node_modules/vinyl-fs/lib/fileOperations.js"],"sourcesContent":["'use strict';\n\nvar fs = require('graceful-fs');\nvar assign = require('object-assign');\nvar isEqual = require('lodash.isequal');\nvar isValidDate = require('vali-date');\n\n// TODO shared module\n// TODO include sticky/setuid/setgid, i.e. 7777?\nvar MASK_MODE = parseInt('0777', 8);\nvar DEFAULT_FILE_MODE = parseInt('0666', 8);\nvar APPEND_MODE_REGEXP = /a/;\n\nfunction closeFd(propagatedErr, fd, callback) {\n  if (typeof fd !== 'number') {\n    return callback(propagatedErr);\n  }\n\n  fs.close(fd, onClosed);\n\n  function onClosed(closeErr) {\n    if (propagatedErr || closeErr) {\n      return callback(propagatedErr || closeErr);\n    }\n\n    callback();\n  }\n}\n\nfunction getModeDiff(fsMode, vinylMode) {\n  var modeDiff = 0;\n\n  if (typeof vinylMode === 'number') {\n    modeDiff = (vinylMode ^ fsMode) & MASK_MODE;\n  }\n\n  return modeDiff;\n}\n\nfunction getTimesDiff(fsStat, vinylStat) {\n\n  if (!isValidDate(vinylStat.mtime)) {\n    return;\n  }\n\n  if (isEqual(vinylStat.mtime, fsStat.mtime) &&\n      isEqual(vinylStat.atime, fsStat.atime)) {\n    return;\n  }\n\n  var atime;\n  if (isValidDate(vinylStat.atime)) {\n    atime = vinylStat.atime;\n  } else {\n    atime = fsStat.atime;\n  }\n\n  if (!isValidDate(atime)) {\n    atime = undefined;\n  }\n\n  var timesDiff = {\n    mtime: vinylStat.mtime,\n    atime: atime,\n  };\n\n  return timesDiff;\n}\n\nfunction isOwner(fsStat) {\n  var hasGetuid = (typeof process.getuid === 'function');\n  var hasGeteuid = (typeof process.geteuid === 'function');\n\n  // If we don't have either, assume we don't have permissions.\n  // This should only happen on Windows.\n  // Windows basically noops fchmod and errors on futimes called on directories.\n  if (!hasGeteuid && !hasGetuid) {\n    return false;\n  }\n\n  var uid;\n  if (hasGeteuid) {\n    uid = process.geteuid();\n  } else {\n    uid = process.getuid();\n  }\n\n  if (fsStat.uid !== uid && uid !== 0) {\n    return false;\n  }\n\n  return true;\n}\n\nfunction updateMetadata(fd, file, callback) {\n\n  fs.fstat(fd, onStat);\n\n  function onStat(err, stat) {\n    if (err) {\n      return callback(err, fd);\n    }\n\n    // Check if mode needs to be updated\n    var modeDiff = getModeDiff(stat.mode, file.stat.mode);\n\n    // Check if atime/mtime need to be updated\n    var timesDiff = getTimesDiff(stat, file.stat);\n\n    // Set file.stat to the reflect current state on disk\n    assign(file.stat, stat);\n\n    // Nothing to do\n    if (!modeDiff && !timesDiff) {\n      return callback(null, fd);\n    }\n\n    // Check access, `futimes` and `fchmod` only work if we own the file,\n    // or if we are effectively root.\n    if (!isOwner(stat)) {\n      return callback(null, fd);\n    }\n\n    if (modeDiff) {\n      return mode();\n    }\n    times();\n\n    function mode() {\n      var mode = stat.mode ^ modeDiff;\n\n      fs.fchmod(fd, mode, onFchmod);\n\n      function onFchmod(fchmodErr) {\n        if (!fchmodErr) {\n          file.stat.mode = mode;\n        }\n        if (timesDiff) {\n          return times(fchmodErr);\n        }\n        callback(fchmodErr, fd);\n      }\n    }\n\n    function times(fchmodErr) {\n      fs.futimes(fd, timesDiff.atime, timesDiff.mtime, onFutimes);\n\n      function onFutimes(futimesErr) {\n        if (!futimesErr) {\n          file.stat.atime = timesDiff.atime;\n          file.stat.mtime = timesDiff.mtime;\n        }\n        callback(fchmodErr || futimesErr, fd);\n      }\n    }\n  }\n}\n\n/*\n  Custom writeFile implementation because we need access to the\n  file descriptor after the write is complete.\n  Most of the implementation taken from node core.\n */\nfunction writeFile(path, data, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  }\n\n  if (!Buffer.isBuffer(data)) {\n    callback(new TypeError('Data must be a Buffer'));\n    return;\n  }\n\n  if (!options) {\n    options = {};\n  }\n\n  // Default the same as node\n  var mode = options.mode || DEFAULT_FILE_MODE;\n  var flag = options.flag || 'w';\n  var position = APPEND_MODE_REGEXP.test(flag) ? null : 0;\n\n  fs.open(path, flag, mode, onOpen);\n\n  function onOpen(err, fd) {\n    if (err) {\n      return onComplete(err);\n    }\n\n    fs.write(fd, data, 0, data.length, position, onComplete);\n\n    function onComplete(err) {\n      callback(err, fd);\n    }\n  }\n}\n\nmodule.exports = {\n  closeFd: closeFd,\n  getModeDiff: getModeDiff,\n  getTimesDiff: getTimesDiff,\n  isOwner: isOwner,\n  updateMetadata: updateMetadata,\n  writeFile: writeFile,\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}