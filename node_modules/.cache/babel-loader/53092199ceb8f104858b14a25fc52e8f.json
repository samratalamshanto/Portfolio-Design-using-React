{"ast":null,"code":"/**\n * Node.js Bar Module\n *\n * Core\n */\nvar core = exports;\n\nvar fs = require('fs'),\n    watch = require('watch');\n\nvar bar = require('../bar');\n/**\n * Bar @constructor\n */\n\n\nfunction Bar(dir, options) {\n  var that = this;\n  /**\n   * Drinkers in a Bar\n   */\n\n  this.drinkers = {};\n  this.drinkersByName = {};\n  /**\n   * Store options\n   */\n\n  this.options = options = bar.utils.merge({\n    EventEmitter: require('../../vendor/EventEmitter2').EventEmitter2,\n    log: null,\n    nolog: false,\n    autoreload: true\n  }, options);\n  /**\n   * Override default logger if it was provided in options\n   */\n\n  if (options.log) {\n    this.log = log;\n  }\n\n  ;\n  /**\n   * Turn off logging if nolog == true\n   */\n\n  if (options.nolog) {\n    this.log = function () {};\n  }\n\n  ;\n  /**\n   * Pool for all pints\n   */\n\n  this.pool = new options.EventEmitter();\n  /**\n   * Monitor file changes in directory\n   */\n\n  watch.watchTree(dir, function (f, curr, prev) {\n    if (curr !== null && curr.nlink === 0) {\n      /**\n       * File was removed\n       */\n      that.leave(f);\n    } else {\n      /**\n       * File was updated/created\n       */\n      if (curr === null) {\n        that.enter(Object.keys(f));\n      } else {\n        if (options.autoreload) {\n          that.enter([f]);\n        }\n      }\n    }\n  });\n  this.log('Node.js Bar Is Open');\n}\n\n;\ncore.Bar = Bar;\n/**\n * Constructor wrapper\n */\n\nfunction create(dir, options) {\n  return new Bar(dir, options);\n}\n\n;\ncore.create = create;\n/**\n * Add files\n */\n\nBar.prototype.enter = function (drinkers) {\n  var that = this;\n  drinkers.forEach(function (file) {\n    /**\n     * Bouncer won't allow any non .js drinkers\n     * to go into a bar\n     */\n    if (!/\\.js$/.test(file)) return;\n    fs.stat(file, function (err, stat) {\n      if (!stat.isFile()) return;\n      /**\n       * Load each file\n       */\n\n      fs.readFile(file, function (err, content) {\n        if (err) {\n          that.log('Failed to load file %s', file, err);\n          return;\n        }\n\n        ;\n        /**\n         * Convert content from Buffer to String\n         */\n\n        content = content.toString();\n        /**\n         * If that drinker was already here\n         * Kick him out and let one come in\n         * (Of course if drinker is still drunk\n         *  we can leave him)\n         */\n\n        if (!that.leave(file, content)) {\n          return;\n        }\n\n        var drinker = bar.drinker.create(file, content, that);\n        that.drinkers[drinker.name] = that.drinkers[file] = drinker;\n        that.log(' > %s goes into a bar', drinker.name);\n      });\n    });\n  });\n};\n/**\n * Remove file\n */\n\n\nBar.prototype.leave = function (drinker, content) {\n  if (this.drinkers[drinker]) {\n    /**\n     * If content was provided - kick drinker only if\n     * hash was changed\n     */\n    if (content) {\n      var hash = bar.utils.sha1(content);\n      if (hash === this.drinkers[drinker].hash) return false;\n    }\n\n    var name = this.drinkers[drinker].name;\n    this.pool.emit('leave.' + name);\n    this.log(' < %s leaves bar', name);\n    /**\n     * Remove drinkers by name and filename from hashmap\n     */\n\n    this.drinkers[drinker] = this.drinkers[name] = null;\n  }\n\n  return true;\n};\n/**\n * Log errors\n */\n\n\nBar.prototype.log = function () {\n  console.log.apply(console, arguments);\n};","map":{"version":3,"names":["core","exports","fs","require","watch","bar","Bar","dir","options","that","drinkers","drinkersByName","utils","merge","EventEmitter","EventEmitter2","log","nolog","autoreload","pool","watchTree","f","curr","prev","nlink","leave","enter","Object","keys","create","prototype","forEach","file","test","stat","err","isFile","readFile","content","toString","drinker","name","hash","sha1","emit","console","apply","arguments"],"sources":["G:/anaconda/project/download files/last down/New folder/desktop/Samrat/protfolio/protfolio/node_modules/bar/lib/bar/core.js"],"sourcesContent":["/**\n * Node.js Bar Module\n *\n * Core\n */\n\nvar core = exports;\n\nvar fs = require('fs'),\n    watch = require('watch');\n\nvar bar = require('../bar');\n\n/**\n * Bar @constructor\n */\nfunction Bar(dir, options) {\n  var that = this;\n\n  /**\n   * Drinkers in a Bar\n   */\n  this.drinkers = {};\n  this.drinkersByName = {};\n\n  /**\n   * Store options\n   */\n  this.options = options = bar.utils.merge({\n    EventEmitter: require('../../vendor/EventEmitter2').EventEmitter2,\n    log: null,\n    nolog: false,\n    autoreload: true\n  }, options);\n\n  /**\n   * Override default logger if it was provided in options\n   */\n  if (options.log) {\n    this.log = log;\n  };\n\n  /**\n   * Turn off logging if nolog == true\n   */\n  if (options.nolog) {\n    this.log = function() {};\n  };\n\n  /**\n   * Pool for all pints\n   */\n  this.pool = new options.EventEmitter();\n\n  /**\n   * Monitor file changes in directory\n   */\n  watch.watchTree(dir, function(f, curr, prev) {\n    if (curr !== null && curr.nlink === 0) {\n      /**\n       * File was removed\n       */\n       that.leave(f);\n    } else {\n      /**\n       * File was updated/created\n       */\n      if (curr === null) {\n        that.enter(Object.keys(f));\n      } else {\n        if (options.autoreload) {\n          that.enter([f]);\n        }\n      }\n    }\n  });\n\n  this.log('Node.js Bar Is Open');\n};\ncore.Bar = Bar;\n\n/**\n * Constructor wrapper\n */\nfunction create(dir, options) {\n  return new Bar(dir, options);\n};\ncore.create = create;\n\n/**\n * Add files\n */\nBar.prototype.enter = function(drinkers) {\n  var that = this;\n\n  drinkers.forEach(function(file) {\n    /**\n     * Bouncer won't allow any non .js drinkers\n     * to go into a bar\n     */\n    if (!/\\.js$/.test(file)) return;\n\n    fs.stat(file, function(err, stat) {\n      if (!stat.isFile()) return;\n      /**\n       * Load each file\n       */\n      fs.readFile(file, function(err, content) {\n        if (err) {\n          that.log('Failed to load file %s', file, err);\n          return;\n        };\n\n        /**\n         * Convert content from Buffer to String\n         */\n        content = content.toString();\n\n        /**\n         * If that drinker was already here\n         * Kick him out and let one come in\n         * (Of course if drinker is still drunk\n         *  we can leave him)\n         */\n        if (!that.leave(file, content)) {\n          return;\n        }\n\n        var drinker = bar.drinker.create(file, content, that);\n        that.drinkers[drinker.name] = that.drinkers[file] = drinker;\n\n        that.log(' > %s goes into a bar', drinker.name);\n      });\n    });\n  });\n};\n\n/**\n * Remove file\n */\nBar.prototype.leave = function(drinker, content) {\n  if (this.drinkers[drinker]) {\n    /**\n     * If content was provided - kick drinker only if\n     * hash was changed\n     */\n    if (content) {\n      var hash = bar.utils.sha1(content);\n      if (hash === this.drinkers[drinker].hash) return false;\n    }\n\n    var name = this.drinkers[drinker].name;\n    this.pool.emit('leave.' + name);\n\n    this.log(' < %s leaves bar', name);\n\n    /**\n     * Remove drinkers by name and filename from hashmap\n     */\n    this.drinkers[drinker] = this.drinkers[name] = null;\n  }\n  return true;\n};\n\n/**\n * Log errors\n */\nBar.prototype.log = function() {\n  console.log.apply(console, arguments);\n};\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}